# Cursor Rules for Launch Site Project

## Development & Cleanup
- Always shutdown development servers after completing changes: `pkill -f "vite" && npm run db:stop`
- Verify no processes on ports 3000-3010 before considering task complete
- Use `npm run db:ensure` to verify Supabase is running before starting development
- Never commit `.env.local` files; use `npm run update-supabase-keys` for environment setup

## Database & Build
- Generate types after schema changes: `npm run db:generate`
- Test migrations locally: `npm run db:reset` 
- Use `./scripts/db-workflow.sh` for complex database operations
- Build for GitHub Pages: `npm run build:github`
- Test with remote Supabase before deploying (backup data first)
- Verify CNAME file for custom domain (citizens.fvcsolutions.com)

## Code Quality
- Resolve all linting errors before completing tasks
- Run builds to verify changes work correctly
- Update README.md instead of creating additional documentation files
- Never commit sensitive data to migration files
- Use `VITE_` prefix for client-side environment variables

## Supabase
- All objects that are not default Supabase features should be in the `public` schema

## Quick Commands
```bash
# Kill all development processes
pkill -f "vite" && pkill -f "npm run start" && npm run db:stop

# Daily workflow
npm start â†’ make changes â†’ npm run db:generate â†’ pkill -f "vite" && npm run db:stop

# Before deploying
npm run start:remote â†’ ./scripts/db-workflow.sh push â†’ npm run build:github
```

# Open Source
Ensure all AI-generated code and content in this repo is **immediately open-source-ready**:
legally clear, secure, documented, reproducible, and maintainable by one person.

## ğŸ“ Repository Hygiene
1. Required top-level files:
   - `README.md` âœ…
   - `.gitignore` âœ…
   - `package.json` âœ…
   - `vite.config.ts` âœ…
   - `tailwind.config.js` âœ…
   - `tsconfig.json` âœ…

2. Directory layout:
   - `src/` - Source code âœ…
   - `scripts/` - Development scripts âœ…
   - `supabase/` - Database configuration âœ…
   - `public/` - Static assets âœ…
   - `dist/` - Build output (gitignored) âœ…

3. Config hygiene:
   - `prettier.config.js` checked into source control âœ…
   - `postcss.config.js` for Tailwind CSS âœ…
   - `tsconfig.node.json` for Vite configuration âœ…
   - `.cursorrules` for development guidelines âœ…

4. Secrets:
   - Never store credentials in `.env.local` âœ…
   - Use `npm run update-supabase-keys` for environment setup âœ…
   - Never commit service role keys âœ…
   - Use environment variables for all configuration âœ…

## ğŸ”’ Security & Supply Chain
1. Pin dependencies; maintain `package-lock.json` âœ…
2. Prefer reproducible builds with Vite âœ…
3. Run vulnerability audits (`npm audit`) before release âœ…
4. Avoid dangerous patterns (`eval`, arbitrary shell exec) âœ…
5. Default to least privilege and safe ports (`127.0.0.1` for dev) âœ…
6. **Supabase Security**:
   - Never use service role keys in client-side code âœ…
   - Always use Row Level Security (RLS) policies âœ…
   - Test with both local and remote Supabase environments âœ…
   - Never commit sensitive data to migration files âœ…
7. **Environment Security**:
   - Use `VITE_` prefix for client-side environment variables âœ…
   - Never commit `.env.local` files âœ…
   - Use `npm run update-supabase-keys` for secure key management âœ…

## ğŸ§° Documentation
1. **README.md**
   - One-screen overview, install, quickstart, test command, license badge.
2. **API Docs**
   - Use docstrings / JSDoc / GoDoc style comments.

## ğŸ§ª Testing & CI
1. **Local Testing**:
   - Test with local Supabase: `npm start`
   - Test with remote Supabase: `npm run start:remote`
   - Test builds: `npm run build` and `npm run build:github`
   - Preview builds: `npm run preview`

2. **Database Testing**:
   - Test migrations locally: `npm run db:reset`
   - Generate types after changes: `npm run db:generate`
   - Use Supabase Studio for database inspection: `npm run db:studio`

3. **Deployment Testing**:
   - Test GitHub Pages build: `npm run build:github`
   - Verify CNAME file for custom domain
   - Test with remote Supabase before deploying

4. **CI Pipeline** (GitHub Actions):
   - Install dependencies: `npm install`
   - Build for GitHub Pages: `npm run build:github`
   - Deploy to GitHub Pages automatically